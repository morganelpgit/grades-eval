---
title: "Le Plomb Morgane"
format: html
editor: visual
---

Link of Git Hub repository : https://github.com/morganelpgit/grades-eval.git 

## 1

```{r}
#| message: false
#| warning: false
here::i_am("grades-eval.Rproj")
library(here)
library(ggplot2)
library(vroom)
library(dplyr)
library(tidyr)
```

### 1 

```{r}
data <- vroom(here("data","courses.csv"))
```

### 2 

```{r}
data |> 
  mutate(
    `course name` = course,
    identifier = course_id,
    trimester = trimester,
    `number of exams` = nb_grades
  ) |>
  select(`course name`, identifier, trimester, `number of exams`) |>
  knitr::kable()
```


```{r}
courses <- data
```

### 3 

```{r}
students <- vroom(here("data","students.csv"))

spec(students)

students <- vroom(here("data","students.csv"), 
                  col_types = cols(
                    id = col_double(),
                       group = col_double(),
                       birth_date = col_date(format = "%Y-%m-%d"),
                       sex = col_factor(),
                       .delim = ","
                       ))

students |> summarise(
  birth_class = class(birth_date),
  sex_class = class(sex),
  group_class = class(group),
  id_class = class(id)
)
```

The birth_date column of the students data frame is of class  `r class(students |> pull(birth_date))`.

The sex column is of class  `r class(students |> pull(sex))`.

The group column is of class  `r class(students |> pull(group))`.

The id column is of class  `r class(students |> pull(id))`.

### 4 

```{r}
#| message: false
#| warning: false
grades <- vroom(here("data","grades.csv"),
                delim = "|",
                na = "*",)
```
## 2 

### 5 

```{r}
students |>
  summarise(n = n(), .by = group) |>
  ggplot(aes(x = group, y = n)) +
  geom_col() +
  labs(
    x = "group",
    y = "number of students"
  ) +
  theme_minimal()
```

### 6 

```{r}
students |>
  ggplot(aes(x = group, fill = sex)) +
  geom_bar(position = "fill") +
  labs(
    x = "group",
    fill = "sex"
  ) +
  theme_minimal()
```

### 7 

```{r}
library(lubridate)

students_age <- students |>
  mutate(
    age = round(time_length(today() - birth_date, unit = "year"))
  )

students_age |>
  ggplot(aes(x = age)) +
  geom_histogram(binwidth = 1) +
  labs(
    x = "age"
  ) +
  theme_minimal()
```
### 8 

```{r}
table <- students_age |>
  summarise(
    median_age = as.integer(median(age)),
    .by = group
  )

table |>
  knitr::kable()
```

### 9 

```{r}
students_age |>
  slice_max(age, n = 1, by = group) |>
  select(id, sex, age, group) |>
  
  arrange(desc(age)) |>
  knitr::kable()
```

## 3 

### 10

```{r}
nb_grades <- grades |>
  filter(!is.na(grade)) |>
  summarise(n = n())

nb_grades <- as.integer(nb_grades)
```

The data set contains `r nb_grades` grades.

### 11

```{r}
grades_courses <- grades |>
  inner_join(courses, by = "course_id")

full_data <- grades_courses |>
  inner_join(students, by = "id")

full_data <- full_data |>
  filter(course == "Cybernetics and Human Augmentation") |>
  summarise(avg_grade = mean(grade, na.rm = TRUE), .by = group)
  
full_data |>
  ggplot(aes(x = group, y = avg_grade)) +
  geom_col() +
  labs(
    x = "group",
    y = "average grade"
  ) +
  theme_minimal()
```


### 12

take all grades of semester, compare distribution of the grade, (not a part course)

```{r}
grades_courses <- grades |>
  inner_join(courses, by = "course_id")

full_data <- grades_courses |>
  inner_join(students, by = "id") |>
  filter(!is.na(grade)) |>
  mutate(trimester = factor(trimester))

full_data |>
  ggplot(aes(x = grade,)) +
  geom_histogram(binwidth = 1) +
  facet_wrap(~ trimester) +
  labs(
    x = "grade",
    y = "count"
  ) +
  theme_minimal()

```

## 4 

### 13 

```{r}
grades_selected <- full_data |>
  select(id, group, sex, grade)

grades_per_student <- grades_selected |>
  summarise(
    n_grades = n(),
    .by = c(id, group, sex)
  )

grades_per_student |>
  slice_head(n = 10) |>
  knitr::kable()

stats <- grades_per_student |>
  summarise(
    minimum = min(n_grades),
    maximum = max(n_grades),
    average = mean(n_grades),
    median  = median(n_grades)
  )

stats |>
  knitr::kable()
```

### 14

```{r}
grades_per_student |>
  ggplot(aes(x = n_grades, fill = sex)) +
  geom_density(alpha = 0.4) +
  labs(
    x = "number of grades",
    y = "density",
    fill = "sex"
  ) +
  theme_minimal()
```
### 15

```{r}
ehs_id <- courses |>
  filter(course == "Energy Harvesting and Sustainability") |>
  pull(course_id)

ehs_per_student <- full_data |>
  filter(course == "Energy Harvesting and Sustainability") |>
  summarise(
    n_grades = n(),
    .by = c(id, group, sex)
  )

ehs_per_student |>
  slice_head(n = 5) |>
  knitr::kable()
```

### 16

```{r}
distribution_ehs <- ehs_per_student |>
  summarise(
    count = n(),
    .by = n_grades
  )

distribution_ehs |>
  ggplot(aes(x = n_grades, y = count)) +
  geom_col() +
  labs(
    x = "number of grades",
    y = "number of students"
  ) +
  theme_minimal()
```
### 17

```{r}
ehs_per_student |>
  ggplot(aes(x = as.factor(group), y = n_grades)) +
  geom_boxplot() +
  labs(
    x = "group",
    y = "number of grades"
  ) +
  theme_minimal()
```
It seems to depend on the group, as the length of the boxplots are not the same.

### 18

```{r}
ehs_per_student |>
  ggplot(aes(x = as.factor(group), y = n_grades, fill = sex)) +
  geom_boxplot() +
  labs(
    x = "group",
    y = "number of grades",
    fill = "sex"
  ) +
  theme_minimal()
```
It seems to depend on the sex as well, as the length of the boxplots in red and blue are not the same.

## 5 

### 19 

```{r}
new_df <- full_data |>
  select(id, group, course, grade) |>
  summarise(
    mean_grade = mean(grade, na.rm = TRUE),
    .by = c(id, group, course)
  ) |>
  pivot_wider(
    names_from = course,
    values_from = mean_grade
  )

new_df |>
  select(id,group,`Artificial Intelligence and Robotics`,`Astroengineering and Planetary Colonization`) |>
  slice_head(n=5) |>
  knitr::kable()
```

### 20

```{r}
new_df |>
  ggplot(aes(
    x = `Interstellar Travel and Navigation`,
    y = `Space Law and Ethics`
  )) +
  geom_point(alpha=0.25) +
  theme_minimal()
```

### 21 

```{r}

```


